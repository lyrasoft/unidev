{"version":3,"sources":["single-image-uploader.js"],"names":["$","plugin","defaultOptions","crop","export_zoom","height","max_height","max_width","min_height","min_width","origin_size","version","width","modal_target","SingleImageDragUploader","element","options","extend","fileData","find","filedrag","fileSelector","filePreview","fileLoader","deleteBox","loader","modal","cropper","saveButton","bindEvents","prototype","self","value","on","event","stopPropagation","preventDefault","addClass","removeClass","cropit","imageBackground","exportZoom","onImageError","error","swal","Phoenix","Translator","translate","sprintf","hide","onImageLoaded","onImageLoading","show","files","originalEvent","target","dataTransfer","handleFileSelect","$input","click","saveImage","$this","is","val","file","checkFile","reader","FileReader","onload","result","image","Image","checkSize","type","src","readAsDataURL","types","allow_types","indexOf","Error","e","message","quality","originalSize","ajax_url","attr","uploadImage","done","res","storeValue","data","url","always","format","post","prop","trigger","fn","jQuery"],"mappings":"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","sourcesContent":["/**\n * Part of unidev project.\n *\n * @copyright  Copyright (C) 2016 {ORGANIZATION}. All rights reserved.\n * @license    GNU General Public License version 2 or later.\n */\n\n(function($) {\n  \"use strict\";\n\n  var plugin = 'singleImageDragUploader';\n\n  var defaultOptions = {\n    crop: true,\n    export_zoom: 1,\n    height: 300,\n    max_height: null,\n    max_width: null,\n    min_height: null,\n    min_width: null,\n    origin_size: false,\n    version: 1,\n    width: 300,\n    modal_target: ''\n  };\n\n  /**\n   * Init class.\n   *\n   * @param {jQuery} element\n   * @param {Object} options\n   *\n   * @constructor\n   */\n  var SingleImageDragUploader = function(element, options) {\n    this.element = element;\n    this.options = $.extend(true, {}, defaultOptions, options);\n\n    // Input\n    this.fileData = this.element.find('.sid-data');\n    this.filedrag = this.element.find('.sid-area');\n    this.fileSelector = this.element.find('.sid-file-select-button');\n    this.filePreview = this.element.find('.sid-preview');\n    this.fileLoader = this.element.find('.sid-img-loader');\n    this.deleteBox = this.element.find('.sid-delete-image');\n    this.loader = this.element.find('.sid-loader');\n\n    // Modal\n    this.modal = $(this.options.modal_target);\n    this.cropper = this.modal.find('.sid-cropper');\n    this.saveButton = this.modal.find('.sid-save-button');\n\n    this.bindEvents();\n  };\n\n  SingleImageDragUploader.prototype = {\n    /**\n     * Bind events.\n     */\n    bindEvents: function() {\n      var self = this;\n      var value;\n\n      this.filedrag.on('dragover', function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(this).addClass('hover');\n      });\n\n      this.filedrag.on('dragleave', function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(this).removeClass('hover');\n      });\n\n      this.cropper.cropit({\n        // imageState: {src: event.target.result},\n        imageBackground: true,\n        exportZoom: this.options.export_zoom,\n        onImageError: function(error) {\n          swal(\n            Phoenix.Translator.translate('unidev.field.single.image.message.invalid.size.title'),\n            Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.desc', self.options.width, self.options.height),\n            'warning'\n          );\n          self.loader.hide();\n        },\n        onImageLoaded: function() {\n          self.modal.modal('show');\n          self.loader.hide();\n        },\n        onImageLoading: function() {\n          self.loader.show();\n        }\n      });\n\n      // Reset file input if modal closed\n      self.modal.on('hide.bs.modal', function() {\n        //$(self.fileSelector).val(null);\n      });\n\n      // File drop\n      this.filedrag.on(\"drop\", function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        $(this).removeClass('hover');\n\n        var files = event.originalEvent.target.files || event.originalEvent.dataTransfer.files;\n\n        self.handleFileSelect(files[0]);\n      });\n\n      // Selector\n      this.fileSelector.on('click', function() {\n        var $input = $('<input type=\"file\">');\n\n        $input.on('change', function(event) {\n          var files = event.originalEvent.target.files || event.originalEvent.dataTransfer.files;\n\n          self.handleFileSelect(files[0])\n        });\n\n        $input.click();\n      });\n\n      // Save button\n      this.saveButton.on('click', function() {\n        self.saveImage();\n      });\n\n      // Delete box\n      if (this.options.version !== 1) {\n        this.deleteBox.on('change', function() {\n          var $this = $(this);\n\n          if ($this.is(':checked')) {\n            value = self.fileData.val();\n            self.fileData.val('');\n          } else {\n            self.fileData.val(value);\n            value = null;\n          }\n        });\n      }\n    },\n\n    /**\n     * Handle file select and raise cropit.\n     *\n     * @param {File} file\n     */\n    handleFileSelect: function(file) {\n      if (!this.checkFile(file)) {\n        return;\n      }\n\n      var self = this;\n      var reader = new FileReader;\n\n      reader.onload = function(event) {\n        if (self.options.crop) {\n          self.cropper.cropit('imageSrc', event.target.result);\n        } else {\n          var image = new Image;\n\n          image.onload = function() {\n            if (!self.checkSize(image)) {\n              return;\n            }\n\n            self.saveImage(event.target.result, file.type);\n          };\n\n          image.src = event.target.result;\n        }\n      };\n\n      reader.readAsDataURL(file);\n    },\n\n    /**\n     * Check file type is image.\n     *\n     * @param {File} file\n     *\n     * @returns {boolean}\n     */\n    checkFile: function(file) {\n      var types = [\n        'image/jpeg',\n        'image/png',\n        'image/webp',\n      ];\n\n      types = this.options.allow_types || types;\n\n      if (types.indexOf(file.type, types) < 0) {\n        swal(\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.image.title'),\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.image.desc'),\n          'error'\n        );\n\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\n     * Check image size.\n     *\n     * @param {Image} image\n     *\n     * @returns {boolean}\n     */\n    checkSize: function(image) {\n      try {\n        if (this.options.max_width !== null && this.options.max_width < image.width) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.max.width', this.options.max_width));\n        }\n\n        if (this.options.min_width !== null && this.options.min_width > image.width) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.min.width', this.options.min_width));\n        }\n\n        if (this.options.max_height !== null && this.options.max_height < image.height) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.max.height', this.options.max_height));\n        }\n\n        if (this.options.min_height !== null && this.options.min_height > image.height) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.min.height', this.options.min_height));\n        }\n      } catch (e) {\n        swal(\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.size.title'),\n          e.message,\n          'error'\n        );\n\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\n     * Save image to input.\n     */\n    saveImage: function(image, type) {\n      var self = this;\n      type = type || 'image/jpeg';\n\n      image = image || this.cropper.cropit('export', {\n        type: type,\n        quality: .9,\n        originalSize: this.options.origin_size || false\n      });\n\n      this.modal.modal('hide');\n\n      if (this.options.ajax_url) {\n        this.filePreview.attr('src', '');\n        this.filePreview.hide();\n        this.fileLoader.show();\n\n        this.uploadImage(image)\n          .done(function (res) {\n            self.storeValue(res.data.url);\n          })\n          .always(function () {\n            self.fileLoader.hide();\n          });\n\n        return;\n      }\n\n      self.storeValue(image);\n    },\n\n    uploadImage: function (image) {\n      var data = {\n        file: image,\n        format: 'base64'\n      };\n\n      return $.post(this.options.ajax_url, data);\n    },\n\n    storeValue: function (image) {\n      this.fileData.val(image);\n      this.filePreview.attr('src', image);\n      this.filePreview.show();\n\n      // Make delete box unchecked\n      this.deleteBox.prop('checked', false);\n\n      // Trigger change\n      this.fileData.trigger('change');\n      this.filePreview.trigger('change');\n    }\n  };\n\n  /**\n   * Push plugins.\n   *\n   * @param options\n   *\n   * @returns {*}\n   */\n  $.fn[plugin] = function(options) {\n    if (!$.data(this, \"unidev.\" + plugin)) {\n      $.data(this, \"unidev.\" + plugin, new SingleImageDragUploader(this, options));\n    }\n\n    return $.data(this, \"unidev.\" + plugin);\n  };\n\n})(jQuery);\n"],"file":"single-image-uploader.js"}