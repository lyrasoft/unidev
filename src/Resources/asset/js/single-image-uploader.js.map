{"version":3,"sources":["single-image-uploader.js"],"names":["$","plugin","defaultOptions","crop","export_zoom","height","max_height","max_width","min_height","min_width","origin_size","version","width","modal_target","SingleImageDragUploader","element","options","extend","fileData","find","filedrag","fileSelector","pasteButton","filePreview","fileLoader","deleteBox","loader","modal","cropper","saveButton","bindEvents","prototype","self","value","on","event","stopPropagation","preventDefault","addClass","removeClass","cropit","imageBackground","exportZoom","onImageError","error","swal","Phoenix","Translator","translate","sprintf","hide","onImageLoaded","onImageLoading","show","files","originalEvent","target","dataTransfer","handleFileSelect","$input","click","navigator","clipboard","read","then","items","type","types","getType","blob","saveImage","$this","is","val","file","checkFile","reader","FileReader","onload","result","image","Image","checkSize","src","readAsDataURL","allow_types","indexOf","Error","e","message","quality","originalSize","ajax_url","attr","uploadImage","done","res","storeValue","data","url","always","format","post","prop","trigger","fn","jQuery"],"mappings":"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","sourcesContent":["/**\n * Part of unidev project.\n *\n * @copyright  Copyright (C) 2016 {ORGANIZATION}. All rights reserved.\n * @license    GNU General Public License version 2 or later.\n */\n\n(function($) {\n  \"use strict\";\n\n  var plugin = 'singleImageDragUploader';\n\n  var defaultOptions = {\n    crop: true,\n    export_zoom: 1,\n    height: 300,\n    max_height: null,\n    max_width: null,\n    min_height: null,\n    min_width: null,\n    origin_size: false,\n    version: 1,\n    width: 300,\n    modal_target: ''\n  };\n\n  /**\n   * Init class.\n   *\n   * @param {jQuery} element\n   * @param {Object} options\n   *\n   * @constructor\n   */\n  var SingleImageDragUploader = function(element, options) {\n    this.element = element;\n    this.options = $.extend(true, {}, defaultOptions, options);\n\n    // Input\n    this.fileData = this.element.find('.sid-data');\n    this.filedrag = this.element.find('.sid-area');\n    this.fileSelector = this.element.find('.sid-file-select-button');\n    this.pasteButton = this.element.find('.sid-paste-button');\n    this.filePreview = this.element.find('.sid-preview');\n    this.fileLoader = this.element.find('.sid-img-loader');\n    this.deleteBox = this.element.find('.sid-delete-image');\n    this.loader = this.element.find('.sid-loader');\n\n    // Modal\n    this.modal = $(this.options.modal_target);\n    this.cropper = this.modal.find('.sid-cropper');\n    this.saveButton = this.modal.find('.sid-save-button');\n\n    this.bindEvents();\n  };\n\n  SingleImageDragUploader.prototype = {\n    /**\n     * Bind events.\n     */\n    bindEvents: function() {\n      var self = this;\n      var value;\n\n      this.filedrag.on('dragover', function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(this).addClass('hover');\n      });\n\n      this.filedrag.on('dragleave', function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n        $(this).removeClass('hover');\n      });\n\n      this.cropper.cropit({\n        // imageState: {src: event.target.result},\n        imageBackground: true,\n        exportZoom: this.options.export_zoom,\n        onImageError: function(error) {\n          swal(\n            Phoenix.Translator.translate('unidev.field.single.image.message.invalid.size.title'),\n            Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.desc', self.options.width, self.options.height),\n            'warning'\n          );\n          self.loader.hide();\n        },\n        onImageLoaded: function() {\n          self.modal.modal('show');\n          self.loader.hide();\n        },\n        onImageLoading: function() {\n          self.loader.show();\n        }\n      });\n\n      // Reset file input if modal closed\n      self.modal.on('hide.bs.modal', function() {\n        //$(self.fileSelector).val(null);\n      });\n\n      // File drop\n      this.filedrag.on(\"drop\", function(event) {\n        event.stopPropagation();\n        event.preventDefault();\n\n        $(this).removeClass('hover');\n\n        var files = event.originalEvent.target.files || event.originalEvent.dataTransfer.files;\n\n        self.handleFileSelect(files[0]);\n      });\n\n      // Selector\n      this.fileSelector.on('click', function() {\n        var $input = $('<input type=\"file\">');\n\n        $input.on('change', function(event) {\n          var files = event.originalEvent.target.files || event.originalEvent.dataTransfer.files;\n\n          self.handleFileSelect(files[0])\n        });\n\n        $input.click();\n      });\n      this.pasteButton.on('click', () => {\n        navigator.clipboard.read().then((items) => {\n          const type = items[0].types[1];\n\n          items[0].getType(type).then((blob) => {\n            this.handleFileSelect(blob);\n          });\n        });\n      });\n\n      // Save button\n      this.saveButton.on('click', function() {\n        self.saveImage();\n      });\n\n      // Delete box\n      if (this.options.version !== 1) {\n        this.deleteBox.on('change', function() {\n          var $this = $(this);\n\n          if ($this.is(':checked')) {\n            value = self.fileData.val();\n            self.fileData.val('');\n          } else {\n            self.fileData.val(value);\n            value = null;\n          }\n        });\n      }\n    },\n\n    /**\n     * Handle file select and raise cropit.\n     *\n     * @param {File} file\n     */\n    handleFileSelect: function(file) {\n      if (!this.checkFile(file)) {\n        return;\n      }\n\n      var self = this;\n      var reader = new FileReader;\n\n      reader.onload = function(event) {\n        if (self.options.crop) {\n          self.cropper.cropit('imageSrc', event.target.result);\n        } else {\n          var image = new Image;\n\n          image.onload = function() {\n            if (!self.checkSize(image)) {\n              return;\n            }\n\n            self.saveImage(event.target.result, file.type);\n          };\n\n          image.src = event.target.result;\n        }\n      };\n\n      reader.readAsDataURL(file);\n    },\n\n    /**\n     * Check file type is image.\n     *\n     * @param {File} file\n     *\n     * @returns {boolean}\n     */\n    checkFile: function(file) {\n      var types = [\n        'image/jpeg',\n        'image/png',\n        'image/webp',\n      ];\n\n      types = this.options.allow_types || types;\n\n      if (types.indexOf(file.type, types) < 0) {\n        swal(\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.image.title'),\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.image.desc'),\n          'error'\n        );\n\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\n     * Check image size.\n     *\n     * @param {Image} image\n     *\n     * @returns {boolean}\n     */\n    checkSize: function(image) {\n      try {\n        if (this.options.max_width !== null && this.options.max_width < image.width) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.max.width', this.options.max_width));\n        }\n\n        if (this.options.min_width !== null && this.options.min_width > image.width) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.min.width', this.options.min_width));\n        }\n\n        if (this.options.max_height !== null && this.options.max_height < image.height) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.max.height', this.options.max_height));\n        }\n\n        if (this.options.min_height !== null && this.options.min_height > image.height) {\n          throw new Error(Phoenix.Translator.sprintf('unidev.field.single.image.message.invalid.size.min.height', this.options.min_height));\n        }\n      } catch (e) {\n        swal(\n          Phoenix.Translator.translate('unidev.field.single.image.message.invalid.size.title'),\n          e.message,\n          'error'\n        );\n\n        return false;\n      }\n\n      return true;\n    },\n\n    /**\n     * Save image to input.\n     */\n    saveImage: function(image, type) {\n      var self = this;\n      type = type || 'image/jpeg';\n\n      image = image || this.cropper.cropit('export', {\n        type: type,\n        quality: .9,\n        originalSize: this.options.origin_size || false\n      });\n\n      this.modal.modal('hide');\n\n      if (this.options.ajax_url) {\n        this.filePreview.attr('src', '');\n        this.filePreview.hide();\n        this.fileLoader.show();\n\n        this.uploadImage(image)\n          .done(function (res) {\n            self.storeValue(res.data.url);\n          })\n          .always(function () {\n            self.fileLoader.hide();\n          });\n\n        return;\n      }\n\n      self.storeValue(image);\n    },\n\n    uploadImage: function (image) {\n      var data = {\n        file: image,\n        format: 'base64'\n      };\n\n      return $.post(this.options.ajax_url, data);\n    },\n\n    storeValue: function (image) {\n      this.fileData.val(image);\n      this.filePreview.attr('src', image);\n      this.filePreview.show();\n\n      // Make delete box unchecked\n      this.deleteBox.prop('checked', false);\n\n      // Trigger change\n      this.fileData.trigger('change');\n      this.filePreview.trigger('change');\n    }\n  };\n\n  /**\n   * Push plugins.\n   *\n   * @param options\n   *\n   * @returns {*}\n   */\n  $.fn[plugin] = function(options) {\n    if (!$.data(this, \"unidev.\" + plugin)) {\n      $.data(this, \"unidev.\" + plugin, new SingleImageDragUploader(this, options));\n    }\n\n    return $.data(this, \"unidev.\" + plugin);\n  };\n\n})(jQuery);\n"],"file":"single-image-uploader.js"}